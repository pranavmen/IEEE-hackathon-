{% extends 'main.html' %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="{% static 'styles/book_appointment.css' %}">

<body>
  <div class="container">
    <h1>Book an Appointment</h1>
    <p class="subtitle">Fill in the details to schedule your consultation</p>

    <form class="appointment-form" action="{% url 'book_appointment' %}" method="POST">
      {% csrf_token %}
      <div class="form-group">
        <label for="patient_name">Patient Name</label>
        {# The backend will use the logged-in user, but we keep this field as requested. #}
        <input type="text" id="patient_name" name="patient_name" value="{{ request.user.name }}" required>
      </div>

      <div class="form-group">
        <label for="doctor">Select Doctor</label>
        {# The 'name' attribute must match your Django form field name. #}
        <select id="doctor" name="doctor" required>
          <option value="">-- Select --</option>
          {# Note: For this to work, your 'book_appointment' view must pass a 'doctors' queryset to the template #}
          {% for doctor in doctors %}
            <option value="{{ doctor.id }}">{{ doctor.name }} - {{ doctor.specialization.name|default:'General' }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="form-group">
        <label for="date">Select Date</label>
        {# The 'name' attribute must match your Django form field name. #}
        <input type="date" id="date" name="appointment_date" required>
      </div>

      <div class="form-group">
        <label for="time">Select Time</label>
        {# The 'name' attribute must match your Django form field name. #}
        <input type="time" id="time" name="appointment_time" required>
      </div>

      <div class="form-group">
        <label for="reason">Reason for Visit</label>
        {# The 'name' attribute must match your Django form field name. #}
        <textarea id="reason" name="reason" rows="4" required></textarea>
      </div>

      <button type="submit" class="btn-submit">Book Appointment</button>
    </form>
  </div>
<script>
  // This script block is preserved exactly as it was in your original file.
  const toggle = document.getElementById('theme-toggle');

  // Load saved preference
  document.addEventListener("DOMContentLoaded", () => {
    const mode = localStorage.getItem('theme');
    if (mode === 'dark') {
      document.body.classList.add('dark');
      if (toggle) {
        toggle.checked = true;
      }
    }
  });

  // Toggle event
  if (toggle) {
    toggle.addEventListener('change', () => {
      if (toggle.checked) {
        document.body.classList.add('dark');
        localStorage.setItem('theme', 'dark');
      } else {
        document.body.classList.remove('dark');
        localStorage.setItem('theme', 'light');
      }
    });
  }
</script>

</body>
{% endblock content %}